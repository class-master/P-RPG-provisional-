�ｻｿ# -*- coding: utf-8 -*-
'''
RPG Rustic Master B 遯ｶ繝ｻDay5繝ｻ閧ｲ蜃ｽ陟募､逡代�ｻ繝ｻ
陋ｻ�ｽｰ鬩戊ｲｻ�ｽｼ螢ｹ繝ｵ郢ｧ�ｽ｣郢晢ｽｼ郢晢ｽｫ郢昴�ｻ遶翫�ｻ郢晁�後Κ郢晢ｽｫ邵ｺ�ｽｮ雎ｬ竏夲ｽ檎ｹｧ蛛ｵﾂ蠕湖溽ｹｧ�ｽｸ郢昴�ｻ縺醍ｸｲ髦ｪ竊堤ｸｺ蜉ｱ窶ｻ驍ｨ繝ｻ竏ｩ驕ｶ荵昶ｻ郢ｧ繝ｻ
TODO繝ｻ蝌釦art_battle / end_battle / handle_battle_key 郢ｧ螳壹�ｻ陋ｻ繝ｻ笳�邵ｺ�ｽ｡邵ｺ�ｽｧ陞ｳ貅ｯ�ｽ｣繝ｻ笘�郢ｧ繝ｻ
'''
from __future__ import annotations

from typing import Optional

# 隨倥�ｻ邵ｺ阮呻ｼ�邵ｺ�ｽｧ邵ｺ�ｽｯ邵ｲ竏壺旺邵ｺ蛹ｻ窶ｻ邵ｲ譎ｯmport 郢ｧ雋槭�ｻ鬩幢ｽｨ隴厄ｽｸ邵ｺ荵昶�醍ｸｺ繝ｻﾂ蜥ｲ諞ｾ隲ｷ荵敖ｰ郢ｧ蟲ｨ縺帷ｹｧ�ｽｿ郢晢ｽｼ郢晏現�ｼ邵ｺ�ｽｾ邵ｺ蜷ｶﾂ繝ｻ
#    Day5 邵ｺ�ｽｮ髫ｱ�ｽｲ鬯伜ｾ娯�堤ｸｺ蜉ｱ窶ｻ邵ｲ竏ｬ繝ｻ陋ｻ繝ｻ笳�邵ｺ�ｽ｡邵ｺ�ｽｧ陟｢繝ｻ�ｽｦ竏壺�� import 郢ｧ螳堋繝ｻ竏ｴ邵ｺ�ｽｦ髴托ｽｽ髫ｪ蛟･�ｼ邵ｺ�ｽｦ邵ｺ�ｽｿ邵ｺ�ｽｦ邵ｺ荳岩味邵ｺ霈費ｼ樒ｸｲ繝ｻ
#
# 陋溷揃�ｽ｣諛岩�堤ｸｺ�ｽｪ郢ｧ荵斟皮ｹｧ�ｽｸ郢晢ｽ･郢晢ｽｼ郢晢ｽｫ邵ｺ貅倪蔓繝ｻ蛹ｻ繝ｲ郢晢ｽｳ郢晁肩�ｽｼ莨夲ｽｼ繝ｻ
# - status_day4  遯ｶ�ｽｦ Status 郢ｧ�ｽｯ郢晢ｽｩ郢ｧ�ｽｹ繝ｻ繝ｻP郢晢ｽｻ隰ｾ�ｽｻ隰ｦ繝ｻ魘ｨ邵ｺ�ｽｪ邵ｺ�ｽｩ繝ｻ繝ｻ
# - battle_engine 遯ｶ�ｽｦ player_attack / enemy_attack 鬮｢�ｽ｢隰ｨ�ｽｰ
# - ui.battle_window 遯ｶ�ｽｦ BattleWindow 郢ｧ�ｽｯ郢晢ｽｩ郢ｧ�ｽｹ繝ｻ蛹ｻ繝ｰ郢晏現ﾎ晞包ｽｻ鬮ｱ�ｽ｢邵ｺ�ｽｮ郢晢ｽｬ郢ｧ�ｽ､郢ｧ�ｽ｢郢ｧ�ｽｦ郢晁肩�ｽｼ繝ｻ
# - json, pathlib.Path 遯ｶ�ｽｦ 隰ｨ�ｽｵ郢昴�ｻ繝ｻ郢ｧ�ｽｿ JSON 郢ｧ螳夲ｽｪ�ｽｭ邵ｺ�ｽｿ髴趣ｽｼ郢ｧﾂ邵ｺ�ｽｨ邵ｺ髦ｪ竊楢抄�ｽｿ邵ｺ繝ｻ

# === 郢晢ｽ｢郢晢ｽｼ郢晁�･�ｽｮ�ｽ｡騾�繝ｻ逡醍ｸｺ�ｽｮ郢ｧ�ｽｰ郢晢ｽｭ郢晢ｽｼ郢晁�湖晁棔逕ｻ辟夂ｸｺ貅倪蔓 =====================================

#: 闔臥ｿｫ縺皮ｹ晢ｽｼ郢晢｣ｰ邵ｺ蠕個蠕後Ψ郢ｧ�ｽ｣郢晢ｽｼ郢晢ｽｫ郢晄�托ｽｸ�ｽｭ邵ｲ髦ｪﾂｰ邵ｲ蠕後Σ郢晏現ﾎ晁叉�ｽｭ邵ｲ髦ｪﾂｰ郢ｧ螳夲ｽ｡�ｽｨ邵ｺ蜷ｶ繝ｵ郢晢ｽｩ郢ｧ�ｽｰ
mode: str = "field"  # "field" / "battle"

#: 郢晏干ﾎ樒ｹｧ�ｽ､郢晢ｽ､郢晢ｽｼ邵ｺ�ｽｮ郢ｧ�ｽｹ郢昴�ｻ繝ｻ郢ｧ�ｽｿ郢ｧ�ｽｹ繝ｻ繝ｻay4 邵ｺ�ｽｮ Status 郢ｧ�ｽｯ郢晢ｽｩ郢ｧ�ｽｹ郢ｧ蜻夷ｦ陞ｳ螟ｲ�ｽｼ繝ｻ
player_status: Optional["Status"] = None

#: 闔臥ｿｫ繝ｰ郢晏現ﾎ晉ｸｺ蜉ｱ窶ｻ邵ｺ繝ｻ�ｽ玖ｬｨ�ｽｵ 1 闖ｴ阮吶�ｻ郢ｧ阮吶�ｻ郢ｧ�ｽｹ郢昴�ｻ繝ｻ郢ｧ�ｽｿ郢ｧ�ｽｹ
enemy_status: Optional["Status"] = None

#: Kivy 闕ｳ鄙ｫ縲堤ｹ晁�後Κ郢晢ｽｫ騾包ｽｻ鬮ｱ�ｽ｢郢ｧ螳夲ｽ｡�ｽｨ驕会ｽｺ邵ｺ蜷ｶ�ｽ狗ｹｧ�ｽｦ郢ｧ�ｽ｣郢ｧ�ｽｸ郢ｧ�ｽｧ郢昴�ｻ繝ｨ
battle_window: Optional["BattleWindow"] = None

#: Kivy 邵ｺ�ｽｮ root 郢晢ｽｬ郢ｧ�ｽ､郢ｧ�ｽ｢郢ｧ�ｽｦ郢晁肩�ｽｼ繝ｻattleWindow 郢ｧ繝ｻadd_widget 邵ｺ蜷ｶ�ｽ玖撻�ｽｴ隰�ﾂ繝ｻ繝ｻ
root_layout = None


# === 郢ｧ�ｽｻ郢昴�ｻ繝ｨ郢ｧ�ｽ｢郢昴�ｻ繝ｻ邵ｺ�ｽｾ郢ｧ荳奇ｽ� =====================================================

def setup_battle_layer(layout, player: "Status") -> None:
    '''
    Day5 邵ｺ�ｽｧ髴托ｽｽ陷会｣ｰ邵ｺ蜷ｶ�ｽ狗ｸｲ蠕後Σ郢晏現ﾎ晞包ｽｨ郢晢ｽｬ郢ｧ�ｽ､郢晢ｽ､邵ｲ髦ｪ�ｽ定ｲ�髢�ｽ咏ｸｺ蜷ｶ�ｽ矩ｫ｢�ｽ｢隰ｨ�ｽｰ邵ｲ繝ｻ

    - Kivy 郢ｧ�ｽ｢郢晏干ﾎ懃ｸｺ�ｽｮ build() 邵ｺ�ｽｪ邵ｺ�ｽｩ邵ｺ荵晢ｽ� 1 陜玲ｧｭ笆｡邵ｺ螟ｧ莉也ｸｺ�ｽｳ陷��ｽｺ邵ｺ蜻斜ｦ陞ｳ繝ｻ
    - BattleWindow 郢ｧ蝣､蜃ｽ隰瑚�鯉ｼ邵ｲ竏ｵ諤呵崕譏ｴ繝ｻ鬮ｱ讚��ｽ｡�ｽｨ驕会ｽｺ邵ｺ�ｽｧ郢晢ｽｬ郢ｧ�ｽ､郢ｧ�ｽ｢郢ｧ�ｽｦ郢晏現竊馴恆�ｽｽ陷会｣ｰ邵ｺ蜉ｱ窶ｻ邵ｺ鄙ｫ�ｿ･
    - 郢晏干ﾎ樒ｹｧ�ｽ､郢晢ｽ､郢晢ｽｼ邵ｺ�ｽｮ Status 郢ｧ蛛ｵ�ｼ�邵ｺ阮吶定将譎�謌溽ｸｺ蜉ｱ窶ｻ邵ｺ鄙ｫ窶ｳ邵ｲ竏壹Σ郢晏現ﾎ晁叉�ｽｭ邵ｺ�ｽｫ陷ｿ繧峨�ｻ邵ｺ�ｽｧ邵ｺ髦ｪ�ｽ狗ｹｧ蛹ｻ竕ｧ邵ｺ�ｽｫ邵ｺ蜷ｶ�ｽ�

    layout:
        隴鯉ｽ｢陝�蛟･繝ｻ郢晁ｼ斐≦郢晢ｽｼ郢晢ｽｫ郢晁�･蛻､鬮ｱ�ｽ｢繝ｻ繝ｻay1/Day2繝ｻ蟲ｨ繝ｻ闕ｳ鄙ｫ竊馴ｩ･髦ｪ繝ｻ郢ｧ荵昶螺郢ｧ竏壹�ｻ郢晢ｽｬ郢ｧ�ｽ､郢ｧ�ｽ｢郢ｧ�ｽｦ郢昴�ｻ
        關灘�ｷ�ｽｼ螢ｹ繝ｵ郢ｧ�ｽ｣郢晢ｽｼ郢晢ｽｫ郢晁�･逡醍ｸｺ�ｽｮ Widget 郢ｧ蜑��ｽｹ蜉ｱ笳狗ｸｺ�ｽｦ邵ｺ繝ｻ�ｽ� FloatLayout 邵ｺ�ｽｪ邵ｺ�ｽｩ
    player:
        郢晏干ﾎ樒ｹｧ�ｽ､郢晢ｽ､郢晢ｽｼ邵ｺ�ｽｮ霑ｴ�ｽｾ陜ｨ�ｽｨ邵ｺ�ｽｮ HP / 隰ｾ�ｽｻ隰ｦ繝ｻ魘ｨ邵ｺ�ｽｪ邵ｺ�ｽｩ郢ｧ蜻域亜邵ｺ�ｽ､ Status 郢ｧ�ｽ､郢晢ｽｳ郢ｧ�ｽｹ郢ｧ�ｽｿ郢晢ｽｳ郢ｧ�ｽｹ
    '''
    global root_layout, player_status, battle_window

    root_layout = layout
    player_status = player

    # TODO: Day4 邵ｺ�ｽｧ闖ｴ諛岩夢邵ｺ繝ｻBattleWindow 郢ｧ繝ｻimport 邵ｺ蜉ｱ窶ｻ邵ｺ阮呻ｼ�邵ｺ�ｽｧ騾墓ｻ薙�ｻ邵ｺ蜷ｶ�ｽ狗ｸｲ繝ｻ
    #  關灘�ｷ�ｽｼ繝ｻfrom ui.battle_window import BattleWindow
    #       window = BattleWindow()
    #       layout.add_widget(window)
    #       window.opacity = 0.0  # 隴崢陋ｻ譏ｴ繝ｻ鬨ｾ荵励�ｻ繝ｻ繝ｻ髫穂ｹ昶斡邵ｺ�ｽｪ邵ｺ繝ｻ�ｽｼ蟲ｨ竊鍋ｸｺ蜉ｱ窶ｻ邵ｺ鄙ｫ�ｿ･
    #
    # 邵ｺ阮吶�ｻ鬮｢�ｽ｢隰ｨ�ｽｰ邵ｺ�ｽｮ郢ｧ�ｽｴ郢晢ｽｼ郢晢ｽｫ繝ｻ繝ｻ
    #   - battle_window 陞溽判辟夂ｸｺ�ｽｫ BattleWindow 邵ｺ�ｽｮ郢ｧ�ｽ､郢晢ｽｳ郢ｧ�ｽｹ郢ｧ�ｽｿ郢晢ｽｳ郢ｧ�ｽｹ邵ｺ謔溘�ｻ邵ｺ�ｽ｣邵ｺ�ｽｦ邵ｺ繝ｻ�ｽ狗ｸｺ阮吮��
    #
    # 陞ｳ貅ｯ�ｽ｣繝ｻ�ｽｾ荵昴�ｻ main_day5_teacher.py 郢ｧ雋樒崟霎｣�ｽｧ邵ｺ蜉ｱ窶ｻ邵ｺ荳岩味邵ｺ霈費ｼ樒ｸｲ繝ｻ
    raise NotImplementedError("Day5 髫ｱ�ｽｲ鬯倥�ｻ setup_battle_layer() 郢ｧ雋橸ｽｮ貅ｯ�ｽ｣繝ｻ�ｼ郢ｧ蛹ｻ竕ｧ")


# === 隰ｨ�ｽｵ郢ｧ�ｽｹ郢昴�ｻ繝ｻ郢ｧ�ｽｿ郢ｧ�ｽｹ邵ｺ�ｽｮ髫ｱ�ｽｭ邵ｺ�ｽｿ髴趣ｽｼ邵ｺ�ｽｿ =================================================

def load_enemy_status(enemy_id: str) -> "Status":
    '''
    隰ｨ�ｽｵ ID 邵ｺ荵晢ｽ� 1 闖ｴ阮吶�ｻ郢ｧ阮吶�ｻ Status 郢ｧ蜑��ｽｽ諛岩夢邵ｺ�ｽｦ髴第鱒笘�邵ｲ繝ｻ

    enemy_id:
        JSON 郢晁ｼ斐＜郢ｧ�ｽ､郢晢ｽｫ `input/enemies_day4.json` 邵ｺ�ｽｫ隴厄ｽｸ邵ｺ荵晢ｽ檎ｸｺ�ｽｦ邵ｺ繝ｻ�ｽ狗ｹｧ�ｽｭ郢晢ｽｼ郢ｧ蜻夷ｦ陞ｳ螢ｹﾂ繝ｻ
        關灘�ｷ�ｽｼ繝ｻ"slime", "bat", "goblin" 邵ｺ�ｽｪ邵ｺ�ｽｩ邵ｲ繝ｻ

    隰鯉ｽｻ郢ｧ髮�ﾂ�ｽ､:
        Status 郢ｧ�ｽｯ郢晢ｽｩ郢ｧ�ｽｹ邵ｺ�ｽｮ郢ｧ�ｽ､郢晢ｽｳ郢ｧ�ｽｹ郢ｧ�ｽｿ郢晢ｽｳ郢ｧ�ｽｹ繝ｻ繝ｻame / max_hp / attack / defense 郢ｧ蜻域亜邵ｺ�ｽ､繝ｻ蟲ｨﾂ繝ｻ
    '''
    # TODO:
    #   1. pathlib.Path 郢ｧ蜑��ｽｽ�ｽｿ邵ｺ�ｽ｣邵ｺ�ｽｦ JSON 郢晁ｼ斐＜郢ｧ�ｽ､郢晢ｽｫ (`input/enemies_day4.json`) 郢ｧ蟶晏ｹ慕ｸｺ繝ｻ
    #   2. json.loads() 邵ｺ�ｽｧ dict 陜吩ｹ昶�楢棔逕ｻ驪､邵ｺ蜷ｶ�ｽ�
    #   3. enemy_id 邵ｺ�ｽｫ陝��ｽｾ陟｢諛岩��郢ｧ荵昴Ι郢晢ｽｼ郢ｧ�ｽｿ郢ｧ雋槫徐郢ｧ髮√�ｻ邵ｺ蜉ｱﾂ繝ｾtatus(...) 郢ｧ蜑��ｽｽ諛岩夢邵ｺ�ｽｦ髴第鱒笘�
    #
    # 郢晏�ｵﾎｦ郢晁肩�ｽｼ繝ｻ
    #   from pathlib import Path
    #   import json
    #
    #   data_path = Path("input/enemies_day4.json")
    #   data = json.loads(data_path.read_text(encoding="utf-8"))
    #   info = data[enemy_id]
    #
    #   return Status(
    #       name=info["name"],
    #       max_hp=info["max_hp"],
    #       attack=info["attack"],
    #       defense=info.get("defense", 0),
    #   )
    #
    # 陞ｳ貅ｯ�ｽ｣繝ｻ笳守ｸｺ�ｽｮ郢ｧ繧�繝ｻ邵ｺ�ｽｯ邵ｲ�ｼｻain_day5_teacher.py 邵ｺ�ｽｫ陞ｳ譴ｧ繝ｻ霑壼現窶ｲ髴亥ｳｨ笆ｲ邵ｺ�ｽｦ邵ｺ繝ｻ竏ｪ邵ｺ蜷ｶﾂ繝ｻ
    raise NotImplementedError("Day5 髫ｱ�ｽｲ鬯倥�ｻ load_enemy_status() 郢ｧ雋橸ｽｮ貅ｯ�ｽ｣繝ｻ�ｼ郢ｧ蛹ｻ竕ｧ")


# === 郢晁�後Κ郢晢ｽｫ鬮｢蜿･�ｽｧ繝ｻ/ 驍ｨ繧��ｽｺ繝ｻ繝ｻ騾�繝ｻ===================================================

def start_battle(enemy_id: str) -> None:
    '''
    郢晁ｼ斐≦郢晢ｽｼ郢晢ｽｫ郢晏ｳｨﾂｰ郢ｧ蟲ｨ繝ｰ郢晏現ﾎ晉ｸｺ�ｽｫ陷茨ｽ･郢ｧ荵昶�堤ｸｺ髦ｪ竊楢惱�ｽｼ邵ｺ�ｽｳ陷��ｽｺ邵ｺ蜥取悴隰ｨ�ｽｰ邵ｲ繝ｻ

    隲�ｽｳ陞ｳ螢ｹ縺咏ｹ晢ｽｼ郢晢ｽｳ:
        - Day3 邵ｺ�ｽｮ邵ｲ蜷娜C 邵ｺ�ｽｫ髫ｧ�ｽｱ邵ｺ蜉ｱﾂｰ邵ｺ莉｣笳�邵ｲ髦ｪ竊堤ｸｺ繝ｻ
        - 霑夲ｽｹ陞ｳ螢ｹ繝ｻ郢晄ｧｭ縺帷ｸｺ�ｽｫ闕ｵ蜉ｱ笆ｲ邵ｺ貅倪�堤ｸｺ繝ｻ
        邵ｺ�ｽｪ邵ｺ�ｽｩ邵ｲ竏壹Ψ郢ｧ�ｽ｣郢晢ｽｼ郢晢ｽｫ郢晉甥繝ｻ邵ｺ�ｽｮ郢ｧ�ｽ､郢晏生ﾎｦ郢昜ｺ･繝ｻ騾�繝ｻﾂｰ郢ｧ迚吩ｻ也ｸｺ�ｽｳ陷��ｽｺ邵ｺ霈費ｽ檎ｹｧ荵敖繝ｻ

    邵ｺ阮呻ｼ�邵ｺ�ｽｧ郢ｧ繝ｻ�ｽ顔ｸｺ貅假ｼ樒ｸｺ阮吮�偵�ｻ蛹ｻ�ｼ顔ｸｺ�ｽ｣邵ｺ荳奇ｽ翫�ｻ繝ｻ

    1. enemy_id 邵ｺ荵晢ｽ芽ｬｨ�ｽｵ邵ｺ�ｽｮ Status 郢ｧ蜑��ｽｽ諛奇ｽ九�ｻ繝ｻoad_enemy_status 郢ｧ雋樔ｻ也ｸｺ�ｽｳ陷��ｽｺ邵ｺ蜻ｻ�ｽｼ繝ｻ
    2. battle_window 邵ｺ�ｽｫ郢晏干ﾎ樒ｹｧ�ｽ､郢晢ｽ､郢晢ｽｼ / 隰ｨ�ｽｵ邵ｺ�ｽｮ郢ｧ�ｽｹ郢昴�ｻ繝ｻ郢ｧ�ｽｿ郢ｧ�ｽｹ郢ｧ螳夲ｽ｡�ｽｨ驕会ｽｺ邵ｺ蜷ｶ�ｽ�
    3. 邵ｲ蠕個諛岩ｲ邵ｺ繧��ｽ臥ｹｧ荳奇ｽ檎ｸｺ貊ゑｽｼ竏堋髦ｪ竊醍ｸｺ�ｽｩ邵ｺ�ｽｮ郢晢ｽ｡郢昴�ｻ縺晉ｹ晢ｽｼ郢ｧ�ｽｸ郢ｧ雋槭�ｻ邵ｺ繝ｻ
    4. battle_window 邵ｺ�ｽｮ opacity 郢ｧ繝ｻ1.0 邵ｺ�ｽｫ邵ｺ蜉ｱ窶ｻ騾包ｽｻ鬮ｱ�ｽ｢邵ｺ�ｽｫ髯ｦ�ｽｨ驕会ｽｺ邵ｺ蜷ｶ�ｽ�
    5. mode 郢ｧ繝ｻ"battle" 邵ｺ�ｽｫ陋ｻ繝ｻ�ｽ願ｭ厄ｽｿ邵ｺ蛹ｻ�ｽ�
    '''
    global mode, enemy_status

    # TODO: 闕ｳ鄙ｫ繝ｻ 1邵ｲ繝ｻ 邵ｺ�ｽｮ隰�遏ｩ�｣ｰ繝ｻ竊鍋ｸｺ�ｽｪ郢ｧ荵晢ｽ育ｸｺ繝ｻ竊鍋ｸｲ竏昴�ｻ騾�繝ｻ�ｽ定ｭ厄ｽｸ邵ｺ繝ｻ窶ｻ邵ｺ�ｽｿ邵ｺ�ｽｾ邵ｺ蜉ｱ�ｽ�邵ｺ繝ｻﾂ繝ｻ
    #
    # 邵ｺ阮呻ｼ�邵ｺ繝ｻDay5 邵ｺ�ｽｮ邵ｲ謔溘�ｻ郢ｧ髮∝鐙邵ｲ髦ｪ竊鍋ｸｺ�ｽｪ郢ｧ蜿･�ｽ､�ｽｧ闔荵昶�鷹ｫ｢�ｽ｢隰ｨ�ｽｰ邵ｺ�ｽｧ邵ｺ蜷ｶﾂ繝ｻ
    # 邵ｺ�ｽｾ邵ｺ螢ｹ繝ｻ print() 邵ｺ�｣ｰ邵ｺ莉｣縲定恪遨ゑｽｽ諛��ｽ｢�ｽｺ髫ｱ繝ｻ遶翫�ｻ邵ｺ譏ｴ繝ｻ邵ｺ繧�竊� BattleWindow 邵ｺ�ｽｫ邵ｺ�ｽ､邵ｺ�ｽｪ邵ｺ闊個繝ｻ
    # 邵ｺ�ｽｨ隹ｿ�ｽｵ鬮ｫ螳亥飭邵ｺ�ｽｫ陞ｳ貅ｯ�ｽ｣繝ｻ笘�郢ｧ荵昶�定楜迚吶�ｻ邵ｺ�ｽｧ邵ｺ蜷ｶﾂ繝ｻ
    raise NotImplementedError("Day5 髫ｱ�ｽｲ鬯倥�ｻ start_battle() 郢ｧ雋橸ｽｮ貅ｯ�ｽ｣繝ｻ�ｼ郢ｧ蛹ｻ竕ｧ")


def end_battle(message: str) -> None:
    '''
    郢晁�後Κ郢晢ｽｫ邵ｺ讙趣ｽｵ繧��ｽ冗ｸｺ�ｽ｣邵ｺ貅倪�堤ｸｺ髦ｪ竊楢惱�ｽｼ邵ｺ�ｽｳ陷��ｽｺ邵ｺ蜥取悴隰ｨ�ｽｰ邵ｲ繝ｻ

    郢ｧ繝ｻ�ｽ顔ｸｺ貅假ｼ樒ｸｺ阮吮�偵�ｻ莠包ｽｾ蜈ｷ�ｽｼ繝ｻ

    - 陟大｢鍋�� message 郢ｧ繝ｻbattle_window 邵ｺ�ｽｫ髯ｦ�ｽｨ驕会ｽｺ邵ｺ蜷ｶ�ｽ�
    - battle_window 郢ｧ蟶晄直髯ｦ�ｽｨ驕会ｽｺ邵ｺ�ｽｫ邵ｺ蜷ｶ�ｽ九�ｻ繝ｻpacity 郢ｧ繝ｻ0.0 邵ｺ�ｽｫ隰鯉ｽｻ邵ｺ蜻ｻ�ｽｼ繝ｻ
    - 隰ｨ�ｽｵ郢ｧ�ｽｹ郢昴�ｻ繝ｻ郢ｧ�ｽｿ郢ｧ�ｽｹ enemy_status 郢ｧ繝ｻNone 邵ｺ�ｽｫ隰鯉ｽｻ邵ｺ繝ｻ
    - mode 郢ｧ繝ｻ"field" 邵ｺ�ｽｫ隰鯉ｽｻ邵ｺ繝ｻ
    - 陟｢繝ｻ�ｽｦ竏壹堤ｸｺ繧��ｽ檎ｸｺ�ｽｰ邵ｲ竏壹�ｻ郢晢ｽｬ郢ｧ�ｽ､郢晢ｽ､郢晢ｽｼ邵ｺ�ｽｮ HP 郢ｧ雋槭�ｻ陜玲ｧｫ�ｽｾ�ｽｩ邵ｺ蜷ｶ�ｽ九�ｻ蝓滄｢ｨ陋ｹ邇ｲ蜃ｾ邵ｺ�ｽｪ邵ｺ�ｽｩ繝ｻ繝ｻ
    '''
    global mode, enemy_status

    # TODO: 闕ｳ鄙ｫ繝ｻ郢ｧ�ｽｳ郢晢ｽ｡郢晢ｽｳ郢晏現�ｽ帝囎荵昶�醍ｸｺ蠕鯉ｽ臥ｸｲ竏壹Σ郢晏現ﾎ晞お繧��ｽｺ繝ｻ蜃ｾ邵ｺ�ｽｮ陷��ｽｦ騾�繝ｻ�ｽ帝お繝ｻ竏ｩ驕ｶ荵昶ｻ邵ｺ�ｽｦ邵ｺ�ｽｿ邵ｺ�ｽｾ邵ｺ蜉ｱ�ｽ�邵ｺ繝ｻﾂ繝ｻ
    #
    # Day5 邵ｺ�ｽｧ邵ｺ�ｽｯ邵ｲ謔滉ｺｫ陋ｻ�ｽｩ隴弱ｅﾂ髦ｪ竊堤ｸｲ譴ｧ鬚ｨ陋ｹ邇ｲ蜃ｾ邵ｲ髦ｪ縲定氣莉｣�ｼ隰厄ｽｯ郢ｧ邇悶�ｻ邵ｺ繝ｻ�ｽ定棔蟲ｨ竏ｴ郢ｧ荵昶�定ｮ鯉ｽｽ邵ｺ蜉ｱ�ｼ樒ｸｺ�ｽｧ邵ｺ蜷ｶ窶ｲ邵ｲ繝ｻ
    # 邵ｺ�ｽｾ邵ｺ螢ｹ繝ｻ邵ｲ蠕娯�千ｸｺ�ｽ｡郢ｧ蟲ｨ縲堤ｹｧ繧�繝ｵ郢ｧ�ｽ｣郢晢ｽｼ郢晢ｽｫ郢晏ｳｨ竊楢ｬ鯉ｽｻ郢ｧ蠕鯉ｽ狗ｸｲ髦ｪ�ｼ�邵ｺ�ｽｨ郢ｧ雋樞煤陷亥現�ｼ邵ｺ�ｽｦ OK 邵ｺ�ｽｧ邵ｺ蜷ｶﾂ繝ｻ
    raise NotImplementedError("Day5 髫ｱ�ｽｲ鬯倥�ｻ end_battle() 郢ｧ雋橸ｽｮ貅ｯ�ｽ｣繝ｻ�ｼ郢ｧ蛹ｻ竕ｧ")


# === 郢晁�後Κ郢晢ｽｫ闕ｳ�ｽｭ邵ｺ�ｽｮ郢ｧ�ｽｭ郢晢ｽｼ陷茨ｽ･陷牙ｸ帙�ｻ騾�繝ｻ===============================================

def handle_battle_key(key: str) -> None:
    '''
    郢晁�後Κ郢晢ｽｫ闕ｳ�ｽｭ邵ｺ�ｽｫ郢ｧ�ｽｭ郢晢ｽｼ邵ｺ譴ｧ谺ｾ邵ｺ霈費ｽ檎ｸｺ貅倪�堤ｸｺ髦ｪ繝ｻ陷��ｽｦ騾�繝ｻ�ｽ帝勗蠕娯鴬邵ｲ繝ｻ

    闔蛾宦螻鍋ｸｺ�ｽｮ Day5 邵ｺ�ｽｧ邵ｺ�ｽｯ邵ｲ竏ｵ諤呵抄譛ｱ蜑樒ｸｲ遯� 郢ｧ�ｽｭ郢晢ｽｼ邵ｺ�ｽｧ隰ｾ�ｽｻ隰ｦ繝ｻﾂ髦ｪ窶ｲ邵ｺ�ｽｧ邵ｺ髦ｪ�ｽ檎ｸｺ�ｽｰ OK 邵ｺ�ｽｧ邵ｺ蜷ｶﾂ繝ｻ
    闖ｴ蜷晞ｴｨ邵ｺ蠕娯旺郢ｧ蠕後�ｻ邵ｲ豐� 郢ｧ�ｽｭ郢晢ｽｼ邵ｺ�ｽｧ鬮ｦ�ｽｲ陟包ｽ｡邵ｲ髦ｪﾂ髱ｴ 郢ｧ�ｽｭ郢晢ｽｼ邵ｺ�ｽｧ鬨ｾ繝ｻ�ｿ｡郢ｧ荵敖髦ｪ竊醍ｸｺ�ｽｩ郢ｧ螳夲ｽｿ�ｽｽ陷会｣ｰ邵ｺ蜉ｱ窶ｻ郢ｧ繧茨ｽｧ荵晢ｼ樒ｸｺ�ｽｾ邵ｺ蟶呻ｽ鍋ｸｲ繝ｻ
    '''
    global player_status, enemy_status

    if key.lower() != "a":
        # A 郢ｧ�ｽｭ郢晢ｽｼ闔会ｽ･陞滓じ繝ｻ邵ｲ竏ｽ�ｽｻ髮∝ｱ鍋ｸｺ�ｽｯ闖ｴ霈費ｽらｸｺ蜉ｱ竊醍ｸｺ繝ｻ
        return

    if player_status is None or enemy_status is None:
        # 邵ｺ�ｽｾ邵ｺ�｣ｰ郢晁�後Κ郢晢ｽｫ邵ｺ�ｽｮ雋�髢�ｽ咏ｸｺ蠕後堤ｸｺ髦ｪ窶ｻ邵ｺ繝ｻ竊醍ｸｺ繝ｻ�｣ｰ�ｽｴ陷ｷ蛹ｻ繝ｻ闖ｴ霈費ｽらｸｺ蜉ｱ竊醍ｸｺ繝ｻ
        return

    # TODO:
    #   1. battle_engine.player_attack() 郢ｧ雋樔ｻ也ｹｧ阮吶堤ｸｲ竏ｵ髮ｰ邵ｺ�ｽｫ郢敖郢晢ｽ｡郢晢ｽｼ郢ｧ�ｽｸ郢ｧ蜑��ｽｸ蠑ｱ竏ｴ郢ｧ繝ｻ
    #   2. BattleWindow 郢ｧ蜑��ｽｽ�ｽｿ邵ｺ�ｽ｣邵ｺ�ｽｦ HP 髯ｦ�ｽｨ驕会ｽｺ邵ｺ�ｽｨ郢晢ｽ｡郢昴�ｻ縺晉ｹ晢ｽｼ郢ｧ�ｽｸ郢ｧ蜻亥ｳｩ隴��ｽｰ邵ｺ蜷ｶ�ｽ�
    #   3. 隰ｨ�ｽｵ邵ｺ謔淞蛛ｵ�ｽ檎ｸｺ貅假ｽ� end_battle("邵ｲ諛奇ｽ� 邵ｺ貅倪凰邵ｺ蜉ｱ笳�繝ｻ繝ｻ) 郢ｧ雋樔ｻ也ｹｧ阮吶帝お繧��ｽｺ繝ｻ笘�郢ｧ繝ｻ
    #   4. 陋溷�ｵ�ｽ檎ｸｺ�ｽｦ邵ｺ繝ｻ竊醍ｸｺ莉｣�ｽ檎ｸｺ�ｽｰ邵ｲ窶蕨emy_attack() 邵ｺ�ｽｧ陷ｿ閧ｴ闌ｶ邵ｺ霈披雷郢ｧ繝ｻ
    #   5. 郢晏干ﾎ樒ｹｧ�ｽ､郢晢ｽ､郢晢ｽｼ邵ｺ謔淞蛛ｵ�ｽ檎ｸｺ貅假ｽ臥ｸｲ�ｼ蘖 郢ｧ雋槭�ｻ陜玲ｧｫ�ｽｾ�ｽｩ邵ｺ霈披雷邵ｺ�ｽｦ邵ｺ荵晢ｽ� end_battle("郢ｧ繝ｻ�ｽ臥ｹｧ蠕娯ｻ邵ｺ蜉ｱ竏ｪ邵ｺ�ｽ｣邵ｺ貅ｪﾂ�ｽｦ") 郢ｧ雋樔ｻ也ｸｺ�ｽｶ
    #
    # 邵ｺ阮吮蔓郢ｧ蟲ｨ�ｽらｸｲ竏晢ｽｮ貅ｯ�ｽ｣繝ｻ�ｽｾ荵昴�ｻ main_day5_teacher.py 邵ｺ�ｽｫ髴亥ｳｨ笆ｲ邵ｺ�ｽｦ邵ｺ繝ｻ竏ｪ邵ｺ蜷ｶﾂ繝ｻ
    raise NotImplementedError("Day5 髫ｱ�ｽｲ鬯倥�ｻ handle_battle_key() 郢ｧ雋橸ｽｮ貅ｯ�ｽ｣繝ｻ�ｼ郢ｧ蛹ｻ竕ｧ")


# === 陷茨ｽｨ闖ｴ阮吶�ｻ郢ｧ�ｽｭ郢晢ｽｼ陷茨ｽ･陷牙ｸ吶Ρ郢晢ｽｳ郢晏ｳｨﾎ� ===============================================

def on_key_press(key: str) -> None:
    '''
    郢ｧ�ｽｲ郢晢ｽｼ郢晢｣ｰ陷茨ｽｨ闖ｴ阮吶堤ｹｧ�ｽｭ郢晢ｽｼ邵ｺ譴ｧ谺ｾ邵ｺ霈費ｽ檎ｸｺ貅倪�堤ｸｺ髦ｪ竊楢惱�ｽｼ邵ｺ�ｽｳ陷��ｽｺ邵ｺ霈費ｽ檎ｹｧ蛹ｺﾎｦ陞ｳ螢ｹ繝ｻ鬮｢�ｽ｢隰ｨ�ｽｰ邵ｲ繝ｻ

    - mode 邵ｺ繝ｻ"battle" 邵ｺ�ｽｮ邵ｺ�ｽｨ邵ｺ繝ｻ遶翫�ｻ郢晁�後Κ郢晢ｽｫ騾包ｽｨ邵ｺ�ｽｮ handle_battle_key() 邵ｺ�ｽｫ陷��ｽｦ騾�繝ｻ�ｽ定ｲゑｽ｡邵ｺ繝ｻ
    - mode 邵ｺ繝ｻ"field" 邵ｺ�ｽｮ邵ｺ�ｽｨ邵ｺ繝ｻ遶翫�ｻ陟墓瑳謫らｸｺ�ｽｩ邵ｺ鄙ｫ�ｽ顔ｸｲ竏ｫ�ｽｧ�ｽｻ陷崎ｼ費ｽ�闔ｨ螟奇ｽｩ�ｽｱ陷��ｽｦ騾�繝ｻ�ｽ帝勗蠕娯鴬

    陞ｳ貊�蝨邵ｺ�ｽｮ郢晏干ﾎ溽ｹｧ�ｽｸ郢ｧ�ｽｧ郢ｧ�ｽｯ郢晏現縲堤ｸｺ�ｽｯ邵ｲ�ｼ斬y1/Day2 邵ｺ�ｽｮ App 郢ｧ�ｽｯ郢晢ｽｩ郢ｧ�ｽｹ郢ｧ繝ｻ
    Window.bind(on_key_down=...) 邵ｺ�ｽｮ郢ｧ�ｽｳ郢晢ｽｼ郢晢ｽｫ郢晁�後Ε郢ｧ�ｽｯ邵ｺ荵晢ｽ臥ｸｺ阮吶�ｻ鬮｢�ｽ｢隰ｨ�ｽｰ郢ｧ雋樔ｻ也ｸｺ�ｽｳ陷��ｽｺ邵ｺ蜷晢ｽｽ�ｽ｢郢ｧ蜻夷ｦ陞ｳ螢ｹ�ｼ邵ｺ�ｽｦ邵ｺ繝ｻ竏ｪ邵ｺ蜷ｶﾂ繝ｻ
    '''
    if mode == "battle":
        # 郢晁�後Κ郢晢ｽｫ闕ｳ�ｽｭ邵ｺ�ｽｯ邵ｲ竏壺��邵ｺ�ｽｹ邵ｺ�ｽｦ邵ｺ�ｽｮ郢ｧ�ｽｭ郢晢ｽｼ陷茨ｽ･陷牙ｸ呻ｽ堤ｹ晁�後Κ郢晢ｽｫ邵ｺ�ｽｫ陝�繧��ｽｿ�ｽｵ邵ｺ霈披雷郢ｧ繝ｻ
        handle_battle_key(key)
        return

    # 邵ｺ阮呻ｼ�邵ｺ荵晢ｽ芽叉荵昴�ｻ邵ｲ蠕後Ψ郢ｧ�ｽ｣郢晢ｽｼ郢晢ｽｫ郢晏ｳｨﾎ皮ｹ晢ｽｼ郢晏ｳｨﾂ髦ｪ繝ｻ邵ｺ�ｽｨ邵ｺ髦ｪ竊鍋ｸｺ�｣ｰ邵ｺ螟ｧ�ｽｮ貅ｯ�ｽ｡蠕鯉ｼ�郢ｧ蠕鯉ｽ狗ｸｲ繝ｻ
    if key in ("up", "down", "left", "right"):
        # TODO: 隴鯉ｽ｢陝�蛟･繝ｻ郢晏干ﾎ樒ｹｧ�ｽ､郢晢ｽ､郢晢ｽｼ驕假ｽｻ陷榊供繝ｻ騾�繝ｻ竊楢ｮ門玄�ｽｸ�ｽ｡邵ｺ蜉ｱ笘�郢ｧ荵敖繝ｻ
        # 關灘�ｷ�ｽｼ繝ｻmove_player(key) 邵ｺ�ｽｪ邵ｺ�ｽｩ邵ｺ�ｽｮ鬮｢�ｽ｢隰ｨ�ｽｰ郢ｧ雋樔ｻ也ｸｺ�ｽｶ邵ｲ繝ｻ
        return

    if key == "e":
        # TODO: Day3 邵ｺ�ｽｧ闖ｴ諛岩夢邵ｺ貅伉蜷娜C 邵ｺ�ｽｫ髫ｧ�ｽｱ邵ｺ蜉ｱﾂｰ邵ｺ莉｣�ｽ狗ｸｲ讎翫�ｻ騾�繝ｻ繝ｻ闕ｳﾂ鬩幢ｽｨ邵ｺ荵晢ｽ�
        #       start_battle("slime") 邵ｺ�ｽｪ邵ｺ�ｽｩ郢ｧ雋樔ｻ也ｸｺ�ｽｳ陷��ｽｺ邵ｺ蜉ｱ窶ｻ邵ｺ�ｽｿ邵ｺ�ｽｾ邵ｺ蜉ｱ�ｽ�邵ｺ繝ｻﾂ繝ｻ
        #
        # 邵ｺ�ｽｩ邵ｺ�ｽｮ NPC / 郢ｧ�ｽ､郢晏生ﾎｦ郢晏現ﾂｰ郢ｧ蟲ｨ竊千ｸｺ�ｽｮ隰ｨ�ｽｵ ID 郢ｧ雋樔ｻ也ｸｺ�ｽｶ邵ｺ荵昴�ｻ邵ｲ竏壹Γ郢晢ｽｼ郢晢｣ｰ邵ｺ�ｽｧ騾ｶ�ｽｸ髫ｲ繝ｻ�ｼ邵ｺ�ｽｦ雎趣ｽｺ郢ｧ竏壺ｻ OK 邵ｺ�ｽｧ邵ｺ蜷ｶﾂ繝ｻ
        return


if __name__ == "__main__":
    print("Day5 騾包ｽｨ邵ｺ�ｽｮ main_day5.py 邵ｺ�ｽｧ邵ｺ蜷ｶﾂ繝ｻ)
    print("陞ｳ貊�蝨邵ｺ�ｽｮ郢ｧ�ｽｲ郢晢ｽｼ郢晢｣ｰ邵ｺ�ｽｧ邵ｺ�ｽｯ邵ｲ縲｝p 郢ｧ�ｽｯ郢晢ｽｩ郢ｧ�ｽｹ邵ｺ荵晢ｽ� setup_battle_layer() / on_key_press() 郢ｧ雋樔ｻ也ｸｺ�ｽｳ陷��ｽｺ邵ｺ蜉ｱ窶ｻ闖ｴ�ｽｿ邵ｺ繝ｻ竏ｪ邵ｺ蜷ｶﾂ繝ｻ)
