# Day6：経験値とレベルアップの日（7人×3時間用シナリオ）

## 0. 今日のゴール（先生が最初に読む用）

3時間で、次の4つを「クラス全体」として完成させます。

1. 敵を倒すと経験値（EXP）が入る  
2. 一定量たまるとレベル（Lv）が 1 上がる  
3. レベルアップと同時に最大HPや攻撃力が上がる  
4. その様子が画面のメッセージや表示から分かる  

### 絶対ルール

- Day1〜Day5 の動くコードを壊さない（上書きしない）  
- 触る場所は、このプリントに書いてあるファイルだけ  
- 分からなくなったら必ず先生かこのプリントに戻る  

---

## 1. 今日の7人の役割（先に割り当てる）

| No | 役割名                 | 触るファイル                         | ざっくりやること                                   |
|----|------------------------|--------------------------------------|----------------------------------------------------|
| A  | ステータス拡張担当     | `status_day4.py` またはコピー       | Lv / EXP / 次の必要EXP を Status に追加する       |
| B  | レベルアップ計算担当   | `status_day4.py` またはコピー       | `gain_exp` と `level_up` の中身を考えて実装する   |
| C  | バトル報酬担当         | `battle_engine.py`                   | 敵撃破時に EXP を増やす処理を足す                 |
| D  | レベルアップ表示担当   | `ui/battle_window.py`                | 「○EXP獲得」「レベルアップ！」のメッセージを出す |
| E  | HUD表示担当            | フィールドの HUD 用ファイルなど     | 画面のどこかに Lv / EXP を表示する                |
| F  | つなぎ込み担当         | `main_day6.py` （新規想定）          | A〜E を 1 本のゲームの流れとして結線する          |
| G  | テスト & 記録担当      | `docs/Day6_buglog.md` など           | 動作確認とバグ・調整点のメモを書く                |

> 先生へ：  
> A〜G それぞれに生徒の名前を書き込んで配ってください。  
> 例：A=太郎、B=花子、… のように。  
> Day6 では「完成させること」よりも「成長のしくみを理解すること」を大事にします。

---

## 2. 今日の時間割（板書用）

- 0:00〜0:15　役割説明・割り当て（このプリントを読む）  
- 0:15〜1:10　**個人作業**（A〜E中心、F/Gはサポート）  
- 1:10〜2:10　**結合タイム**（Fがハブ、A〜Eのコードを `main_day6.py` に接続）  
- 2:10〜2:50　テスト & バランス調整（G主導）  
- 2:50〜3:00　今日のまとめ・画面お披露目  

---

## 3. 各役割の「やることチェックリスト」

### 3-1. A：ステータス拡張担当

**目的**：Day4 までの `Status` に「成長に必要な情報（Lv / EXP）」を足す。

- 触るファイル：`status_day4.py` を **コピーしてから** 触るのがおすすめです。  
  （例）`status_day6_student.py` を新しく作り、そちらを編集する。  
- 触ってはいけないファイル：元の `status_day4.py` を直接壊さないこと。

#### Aさんのチェックリスト

- [ ] `status_day6_student.py` を作り、中身を `status_day4.py` からコピーした  
- [ ] `level` / `exp` / `next_exp` フィールドを `Status` に追加した  
- [ ] `__init__` でそれぞれ初期値を入れている（例：Lv1 / EXP0 / next_exp10）  
- [ ] エラーが出ずに `from status_day6_student import Status` できる  

#### サンプルコード（ほぼコピペOK・先生向け回答例）

```python
# status_day6_student.py
# Day6 用：レベルと経験値つきの Status クラス（生徒用）

class Status:
    """プレイヤーや敵のステータスを表すクラス（Day6版）。"""

    def __init__(self, name, max_hp, attack, defense=0):
        # ★ ここまでは Day4 と同じ
        self.name = name
        self.max_hp = max_hp
        self.hp = max_hp
        self.attack = attack
        self.defense = defense

        # ★ ここから Day6 で追加するフィールド
        # level: 現在のレベル（とりあえず1からスタート）
        self.level = 1

        # exp: いままでに貯めた経験値（経験のポイント）
        self.exp = 0

        # next_exp: 次のレベルに上がるまでに必要な経験値
        # ここでは、とりあえず「10ポイントでレベル2」になるようにしておく。
        self.next_exp = 10
```

> ✅ Aさんは「**成長に必要な情報の箱を用意する人**」です。  
> 実際に増やしたり、レベルアップさせるのは B / C / F の仕事です。

---

### 3-2. B：レベルアップ計算担当

**目的**：EXP がたまったときに、どうやって Lv やステータスを上げるかを決める。

- 触るファイル：Aさんと同じ `status_day6_student.py`  
- 相談したい相手：A（フィールド名）、C（もらえるEXPの量）

#### Bさんのチェックリスト

- [ ] `gain_exp(self, amount: int)` メソッドを作った  
- [ ] 中で `self.exp` に `amount` を足している  
- [ ] `exp >= next_exp` のときに `level_up()` を呼ぶようにした  
- [ ] `level_up()` で、HP / 攻撃力などが増えるようになっている  

#### サンプルコード（TODO入りのひな型・生徒用）

```python
class Status:
    # ... Aさんが書いた __init__ の続き ...

    def gain_exp(self, amount: int):
        """経験値を受け取り、必要ならレベルアップする。"""
        # TODO: マイナスの値が来たときは 0 に直しておくと安全です。
        if amount < 0:
            amount = 0

        # TODO: いま持っている exp に amount を足しましょう。
        self.exp += amount

        # TODO: exp が next_exp 以上になったら level_up() を呼びます。
        while self.exp >= self.next_exp:
            self.level_up()

    def level_up(self):
        """レベルを1つ上げ、ステータスも少し強くする。"""
        # 1) レベルを1上げる
        self.level += 1

        # 2) 最大HPと攻撃力を少し上げる（数字はチームで相談して決めてOK）
        #    例：レベル1上がるごとに HP+5, 攻撃+2
        self.max_hp += 5
        self.attack += 2

        # 3) レベルアップしたら HP を全回復しても良いし、そのままでも良い。
        #    ここでは、分かりやすさのために全回復してみる。
        self.hp = self.max_hp

        # 4) 次のレベルまでに必要なEXPを増やす（だんだん必要量を増やしたい場合）
        #    例：毎回 +5 する / 2倍にする など。ここでは +5。
        self.exp -= self.next_exp
        self.next_exp += 5
```

> ✅ Bさんは「**成長のルールを決める人**」です。  
> 数字（+5 や +2）は、ゲームの難しさに直結するので、チームで相談して決めましょう。

---

### 3-3. C：バトル報酬担当

**目的**：敵を倒したときに、プレイヤーが EXP をもらえるようにする。

- 触るファイル：`battle_engine.py` を **コピーしてから** 触るのがおすすめです。  
  （例）`battle_engine_day6_student.py` を新しく作る。  
- 相談したい相手：B（1回のバトルで何ポイントくらい欲しいか）

#### Cさんのチェックリスト

- [ ] `battle_engine_day6_student.py` を作り、中身を `battle_engine.py` からコピーした  
- [ ] `from status_day6_student import Status` に変更した  
- [ ] `player_attack` の中で、敵が倒れた瞬間に `player.gain_exp(...)` を呼ぶようにした  
- [ ] もらえるEXP量を「定数」や「敵ごとの辞書」で決めている  

#### サンプルコード（敵を倒したら10EXPもらう例）

```python
from status_day6_student import Status

def player_attack(player: Status, enemy: Status) -> int:
    """プレイヤーから敵への攻撃。敵を倒したらEXPをもらう。"""
    dmg = calc_damage(player, enemy)
    enemy.take_damage(dmg)

    # ★ ここから Day6 の追加処理
    if enemy.is_dead():
        # TODO: とりあえず 10 EXP をもらうようにしてみる。
        gained = 10
        player.gain_exp(gained)
        # ここで「○EXP手に入れた！」という文字を出すのは D さんの担当です。

    return dmg
```

> ✅ Cさんは「**バトルのごほうび係**」です。  
> 「1回勝つとどれくらい強くなるか？」を、ゲームバランスを考えながら決めましょう。

---

### 3-4. D：レベルアップ表示担当

**目的**：バトル中の画面に「○EXP獲得」や「レベルアップ！」と表示して、成長を実感できるようにする。

- 触るファイル：`ui/battle_window.py`（必要なら `.kv` も）  
- 相談したい相手：C（EXP獲得のタイミング）、B（レベルアップの条件）

#### Dさんのチェックリスト

- [ ] `BattleWindow` に EXP やレベルアップ用のメッセージを表示する処理がある  
- [ ] プレイヤーが敵を倒したときに「○EXPを手に入れた！」と1行表示される  
- [ ] レベルアップしたときに「レベル○になった！ HPが△増えた！」と表示される  

#### サンプルコード（message をそのまま使う簡単な例）

```python
class BattleWindow(BoxLayout):
    # ... 既存のプロパティ定義 ...

    def show_get_exp(self, amount: int):
        """EXPを手に入れたとき用のメッセージ。"""
        self.message = f"{amount} EXP を手に入れた！"

    def show_level_up(self, status):
        """レベルアップしたとき用のメッセージ。"""
        self.message = (
            f"{status.name} のレベルが {status.level} に上がった！\n"
            f"HP が {status.max_hp} に、攻撃力が {status.attack} になった！"
        )
```

> ✅ Dさんは「**頑張りが目に見えるようにする人**」です。  
> 文字の言い回しや改行は、チームの好みに合わせてアレンジしてOKです。

---

### 3-5. E：HUD表示担当

**目的**：フィールド画面などに「Lv: ○ / EXP: x / next: y」を出して、いつでも成長具合が分かるようにする。

- 触るファイル：フィールド用の HUD を扱っているファイル（授業環境に合わせて先生が指定）  
- 相談したい相手：A / B（フィールド名）、F（どこから呼ばれているか）

#### Eさんのチェックリスト

- [ ] プレイヤーの `Status` にアクセスできる場所を特定した  
- [ ] Label などで「Lv: ○ / EXP: x / next: y」と表示した  
- [ ] レベルアップしたあと、表示がちゃんと更新されることを確認した  

> ✅ Eさんは「**いつでも成長具合を見える化する人**」です。  
> 難しい場合は、まずは HP の横に「Lv: ○」だけ出すところからでもOKです。

---

### 3-6. F：つなぎ込み担当（今日のハブ）

**目的**：A〜E の成果を `main_day6.py`（新規スクリプト）で 1 本のゲームにまとめる。

- 触るファイル：`main_day6.py`（Day5 の `main_day5.py` を参考にして新規作成）  
- 触ってはいけないファイル：`main_day1.py`〜`main_day5.py`（保存しないこと）  

#### Fさんのチェックリスト

- [ ] `main_day5.py` を参考に `main_day6.py` を新規作成した  
- [ ] `status_day6_student.Status` と `battle_engine_day6_student` を使うようにした  
- [ ] 敵を倒したあと、Cさんの `player.gain_exp` が必ず呼ばれる流れになっている  
- [ ] レベルアップしたときに D さん / E さんの表示が更新されている  

> ✅ Fさんは「**線をすべてつなぐ人**」です。  
> import の場所や呼び出し順で詰まったら、必ず先生や A〜E に相談してから変更しましょう。

---

### 3-7. G：テスト & 記録担当

**目的**：みんなのコードを実際に動かし、「ちゃんと成長しているか？」をチェックして記録する。

- 触るファイル：`Day6_buglog.md`（このフォルダ内）  

#### Gさんのチェックリスト

- [ ] `python main_day6.py` で Day6 が起動することを確認した  
- [ ] 同じ敵を複数回倒したとき、EXPが増えていることを確認した  
- [ ] EXP がたまったときにレベルアップすることを確認した  
- [ ] レベルアップ後に HP / 攻撃力 / 表示が変わっていることを確認した  
- [ ] 見つけたバグや違和感を、1件ずつ `Day6_buglog.md` にメモした  

#### バグログの書き方（サンプル）

```text
【2025-xx-xx Day6】

■バグ1：敵を倒してもEXPが増えない
内容：
    同じ敵を3回倒しても、Lv1のままだった。
原因：
    battle_engine_day6_student.py で player.gain_exp(...) を呼んでいなかった。
対策：
    player_attack() の敵が倒れた部分に gain_exp を追加して解決。
```

---

## 4. 全員共通のNGリスト

- Day1〜Day5 のファイルを直接書き換えて壊さない  
- 他の人の担当ファイルを、相談なしに上書きしない  
- 分からないエラーを「見なかったこと」にしない  
  - → Gさんと一緒に `Day6_buglog.md` にメモしてから先生に相談する

---

## 5. 今日のまとめメモ欄（クラス用）

- 今日できたこと：

- 次にやりたいこと（Day7 へのアイデアなど）：

