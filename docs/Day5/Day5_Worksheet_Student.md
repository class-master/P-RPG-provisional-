# Day5：フィールドからバトルへつないでみよう（生徒用ワークシート）

## 1. 今日のゴール

3時間で、次の 3つができていれば OK です。

1. フィールドを歩いている途中に、敵とバトルを始められる  
2. バトル画面で A キーを押すと、お互いの HP が減る  
3. 勝ったら「勝利メッセージ」を出してフィールドへ戻る  
   負けたら HP を全回復して再スタートできる

---

## 2. 触ってよいファイル

今日は次のファイルだけを触します。

- `status_day4.py` … HP や攻撃力などの「ステータス」を表すクラス
- `battle_engine.py` … ダメージの計算をするところ
- `ui/battle_window.py` / `ui/battle_window.kv` … バトル画面の見た目
- `main_day5_student.py` … フィールド ↔ バトルの切り替えロジック（今日のメイン）
- `input/enemies_day4.json` … 敵の HP や攻撃力のデータ
- `docs/Day5/Day5_buglog.md` … テスト結果を書くメモ

> `main_day1.py` / `main_day2.py` は **さわらない** でください。  
> フィールドの描画や移動は、すでに完成している前提です。

---

## 3. 役割（A〜G）とタスク

先生から A〜G の役割が割り振られます。  
自分の役割の行をよく読んで、まずは「何をすればいいか」を把握しましょう。

- A：`status_day4.py`  
  - HP が 0 以下のとき `is_dead()` が True になることを確認
  - コメントを読んでクラスの役割を理解する
- B：`input/enemies_day4.json`  
  - 敵キャラを 3〜4 種類つくる（HP / 攻撃力 / 防御力 など）
- C：`battle_engine.py`  
  - `calc_damage()` の中身を読み、式をノートに写してみる
- D：`ui/battle_window.py` / `.kv`  
  - `update_status()` / `show_message()` がいつ呼ばれるかを確認する
- E：`main_day5_student.py`  
  - `start_battle()` / `end_battle()` / `handle_battle_key()` の TODO を読む
- F：Day3 のフィールド側コード  
  - NPC やイベントから `start_battle("slime")` などを呼ぶ場所を探す
- G：`docs/Day5/Day5_buglog.md`  
  - みんなのゲームを遊んで、不具合をメモしていく

---

## 4. `main_day5_student.py` の読み方

1. ファイル冒頭のコメントで、「Day5 の役割」や「モード (field/battle)」の説明を読む
2. `start_battle()` の中の TODO を読み、「どんな順番で処理したいか」を考える
3. `handle_battle_key()` の中で、A キーが押されたときに  
   - プレイヤー → 敵  
   - 敵 → プレイヤー  
   の順番で攻撃するイメージを持つ
4. `end_battle()` の中で、  
   - 勝ったとき  
   - 負けたとき  
   それぞれどう画面を切り替えるかを考える

---

## 5. テストのコツ

- **まずは 1 体の敵だけ** を相手に完成させる（例：`slime`）
- プレイヤーが何回攻撃したら倒せるかをメモしておく
- JSON の数字（`max_hp` や `attack`）を変えてみて、ゲームバランスがどう変わるか試してみる
- 見つけた不具合は、G 担当の人といっしょに `Day5_buglog.md` に書こう

---

## 6. 今日のふり返り（メモ欄）

- 今日できるようになったこと
- まだよく分からないところ
- 次に作ってみたい仕組み（例：魔法 / アイテム / 逃げる など）

（ここに自由にメモして OK）
